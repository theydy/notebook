<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Git | theydy</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/notebook/icon.png">
    <meta name="description" content="读书笔记 + 知识整理">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.254e6a27.css" as="style"><link rel="preload" href="/notebook/assets/js/app.f2eb6e3f.js" as="script"><link rel="preload" href="/notebook/assets/js/2.b500958f.js" as="script"><link rel="preload" href="/notebook/assets/js/20.69bfd485.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.b947421a.js"><link rel="prefetch" href="/notebook/assets/js/11.680f4f83.js"><link rel="prefetch" href="/notebook/assets/js/12.87321fb9.js"><link rel="prefetch" href="/notebook/assets/js/13.a12941b3.js"><link rel="prefetch" href="/notebook/assets/js/14.9ce5f948.js"><link rel="prefetch" href="/notebook/assets/js/15.fbc4f02f.js"><link rel="prefetch" href="/notebook/assets/js/16.e7edddbd.js"><link rel="prefetch" href="/notebook/assets/js/17.81731b80.js"><link rel="prefetch" href="/notebook/assets/js/18.7a586a2d.js"><link rel="prefetch" href="/notebook/assets/js/19.b17cd2e0.js"><link rel="prefetch" href="/notebook/assets/js/21.037c1c38.js"><link rel="prefetch" href="/notebook/assets/js/22.90e690bd.js"><link rel="prefetch" href="/notebook/assets/js/23.ae42788f.js"><link rel="prefetch" href="/notebook/assets/js/24.ee56036e.js"><link rel="prefetch" href="/notebook/assets/js/25.8618ffd3.js"><link rel="prefetch" href="/notebook/assets/js/26.6eac9750.js"><link rel="prefetch" href="/notebook/assets/js/27.b2175214.js"><link rel="prefetch" href="/notebook/assets/js/3.1df71eba.js"><link rel="prefetch" href="/notebook/assets/js/4.779e3c9b.js"><link rel="prefetch" href="/notebook/assets/js/5.5b45f7ce.js"><link rel="prefetch" href="/notebook/assets/js/6.6924ba3e.js"><link rel="prefetch" href="/notebook/assets/js/7.22950914.js"><link rel="prefetch" href="/notebook/assets/js/8.edafac0c.js"><link rel="prefetch" href="/notebook/assets/js/9.3738fea4.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.254e6a27.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><!----> <span class="site-name">theydy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/interview/js.html" class="nav-link">
  前端面试
</a></div><div class="nav-item"><a href="/notebook/vue/analysis.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/notebook/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/notebook/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/notebook/other/tools.html" class="nav-link">
  杂七杂八
</a></div> <a href="https://github.com/theydy/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notebook/interview/js.html" class="nav-link">
  前端面试
</a></div><div class="nav-item"><a href="/notebook/vue/analysis.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/notebook/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/notebook/webpack/" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/notebook/other/tools.html" class="nav-link">
  杂七杂八
</a></div> <a href="https://github.com/theydy/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>杂七杂八</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/other/tools.html" class="sidebar-link">常用工具</a></li><li><a href="/notebook/other/git.html" aria-current="page" class="active sidebar-link">Git</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/other/git.html#常用-git-操作" class="sidebar-link">常用 Git 操作</a></li><li class="sidebar-sub-header"><a href="/notebook/other/git.html#commit-type" class="sidebar-link">commit type</a></li><li class="sidebar-sub-header"><a href="/notebook/other/git.html#github-actions" class="sidebar-link">GitHub Actions</a></li><li class="sidebar-sub-header"><a href="/notebook/other/git.html#利用-git-hooks-不同项目配置不同-git-账号" class="sidebar-link">利用 git hooks 不同项目配置不同 git 账号</a></li></ul></li><li><a href="/notebook/other/node.html" class="sidebar-link">node</a></li><li><a href="/notebook/other/typescript.html" class="sidebar-link">typescript</a></li><li><a href="/notebook/other/snippets.html" class="sidebar-link">snippets</a></li><li><a href="/notebook/other/babel-plugin.html" class="sidebar-link">《babel 插件通关秘籍》笔记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="git"><a href="#git" class="header-anchor">#</a> Git</h1> <h2 id="常用-git-操作"><a href="#常用-git-操作" class="header-anchor">#</a> 常用 Git 操作</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 将某个分支上的 commit 摘取出来提交到当前分支, -x -s 可选参数，带上 hash 和签名信息</span>
<span class="token function">git</span> cherry-pick <span class="token punctuation">[</span>-x<span class="token punctuation">]</span> <span class="token punctuation">[</span>-s<span class="token punctuation">]</span> xxx

<span class="token comment"># 转移从 A 到 B 的所有提交，包含 A</span>
<span class="token function">git</span> cherry-pick A^<span class="token punctuation">..</span>B
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 通过再次 commit 相反的内容抵消一次 commit</span>
<span class="token function">git</span> revert xxx

<span class="token comment"># 如果要撤销 merge，可使用 -m 参数， 1 | 2 选取恢复后的代码的基准，1 为当前分支，2 为合并过来的分支</span>
<span class="token function">git</span> revert xxx -m <span class="token number">1</span>
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 查看 git 操作记录，然后可以通过 reset —hard HEAD@{n} 来返回到第 n 步时的状态</span>
<span class="token function">git</span> reflog

<span class="token comment"># 撤回 xxx 之后的 commit，将修改放进缓存区</span>
<span class="token function">git</span> reset --soft xxx
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 合并多个提交 n 要大于等于要修改的commit 距离 HEAD 的步数</span>
<span class="token function">git</span> rebase -i HEAD~n

<span class="token comment"># 合并 xxx 之后（不包含xxx）到 head 的 commit</span>
<span class="token function">git</span> rebase -i xxx

<span class="token comment"># 强行关闭fast-forward方式</span>
<span class="token function">git</span> merge xxx —no-ff

<span class="token comment"># 合并时忽略空白符，对于格式化文件之后的合并十分有效</span>
<span class="token function">git</span> merge xxx -Xignore-all-space
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 没有在 git 版本控制中的文件，是不能被 git stash 存起来的, 需要先 git add . 添加到 git 版本控制中</span>
<span class="token function">git</span> stash save ‘save message’

<span class="token comment"># 清空你所有的 stash 内容</span>
<span class="token function">git</span> stash <span class="token function">clear</span>

<span class="token comment"># 这是删除第一个队列</span>
<span class="token function">git</span> stash drop stash@<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span>

<span class="token comment"># 弹出栈顶的修改</span>
<span class="token function">git</span> stash pop
</code></pre></div><h2 id="commit-type"><a href="#commit-type" class="header-anchor">#</a> commit type</h2> <p><code>feat:</code>: 类型为 <code>feat</code> 的提交表示在代码库中新增了一个功能。</p> <p><code>fix:</code>：类型为 <code>fix</code> 的 提交表示在代码库中修复了一个 bug。</p> <p><code>docs:</code>: 只是更改文档。</p> <p><code>style:</code>: 不影响代码含义的变化（空白、格式化、缺少分号等）。</p> <p><code>refactor:</code>: 代码重构，既不修复错误也不添加功能。</p> <p><code>perf:</code>: 改进性能的代码更改。</p> <p><code>test:</code>: 添加确实测试或更正现有的测试。</p> <p><code>build:</code>: 影响构建系统或外部依赖关系的更改（示例范围：gulp、broccoli、NPM）。</p> <p><code>ci:</code>: 更改持续集成文件和脚本（示例范围：Travis、Circle、BrowserStack、SauceLabs）。</p> <p><code>chore:</code>: 其他，不修改<code>src</code>或<code>test</code>文件。</p> <p><code>revert:</code>: commit 回退。</p> <h2 id="github-actions"><a href="#github-actions" class="header-anchor">#</a> GitHub Actions</h2> <p><a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener noreferrer">GitHub Actions 入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="生成密钥"><a href="#生成密钥" class="header-anchor">#</a> 生成密钥</h3> <p><a href="https://docs.github.com/cn/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">创建个人访问令牌<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>将这个密钥储存到当前仓库的 <code>Settings/Secrets</code> 里面，配置 <code>ACCESS_TOKEN</code> 变量。</p> <h3 id="生成-workflow-文件"><a href="#生成-workflow-文件" class="header-anchor">#</a> 生成 workflow 文件</h3> <p>在这个仓库的.github/workflows目录，生成一个 workflow 文件，名字可以随便取，这个示例是ci.yml</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> GitHub Actions Build and Deploy

<span class="token comment"># 触发条件: push 到 master 分支后</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> master

<span class="token comment"># 设置上海时区</span>
<span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai

<span class="token comment"># 任务</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>
    <span class="token comment"># 服务器环境：最新版 ubuntu</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># 拉取代码</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

      <span class="token comment"># 打包静态文件</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token important">&amp;&amp;</span> npm run build

      <span class="token comment"># 部署</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@releases/v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token comment"># GitHub 密钥</span>
          <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token comment"># GitHub Pages 读取的分支</span>
          <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages
          <span class="token comment"># 静态文件所在目录</span>
          <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> dist
</code></pre></div><div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Readme

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">issues</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>opened<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">bot</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token comment"># 执行自己的脚本文件</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run Script
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token important">&amp;&amp;</span> npm run build
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>actions<span class="token punctuation">-</span>x/commit@v2.7
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">push-branch</span><span class="token punctuation">:</span> master
          <span class="token key atrule">commit-message</span><span class="token punctuation">:</span> <span class="token string">'Update README.md by Github Actions'</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> xx
          <span class="token key atrule">email</span><span class="token punctuation">:</span> xx
</code></pre></div><h2 id="利用-git-hooks-不同项目配置不同-git-账号"><a href="#利用-git-hooks-不同项目配置不同-git-账号" class="header-anchor">#</a> 利用 git hooks 不同项目配置不同 git 账号</h2> <p><a href="https://juejin.cn/post/6844903849275162631#heading-3" target="_blank" rel="noopener noreferrer">git hooks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>git hooks</code> 的配置就 <code>.git/hooks</code> 目录下，以无后缀的脚本文件的形式存在，文件名称即是钩子名称，文件内容是 <code>shell</code> 脚本</p> <h3 id="pre-commit"><a href="#pre-commit" class="header-anchor">#</a> pre-commit</h3> <p>需要赋予 git hook 钩子权限 <code>chmod 700 .git/hooks/pre-commit</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token assign-left variable">target_name</span><span class="token operator">=</span><span class="token string">&quot;theydy&quot;</span>
<span class="token assign-left variable">target_email</span><span class="token operator">=</span><span class="token string">&quot;ydythebs@qq.com&quot;</span>

<span class="token assign-left variable">current_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> config user.name<span class="token variable">)</span></span>
<span class="token assign-left variable">current_email</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> config user.email<span class="token variable">)</span></span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$target_name</span> <span class="token operator">==</span> <span class="token variable">$current_name</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token variable">$target_email</span> <span class="token operator">==</span> <span class="token variable">$current_email</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">else</span>
  <span class="token function">git</span> config user.name <span class="token variable">$target_name</span>
  <span class="token function">git</span> config user.email <span class="token variable">$target_email</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;项目 git 账号切换成功，请再次提交&quot;</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">7/8/2021, 9:51:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notebook/other/tools.html" class="prev">
        常用工具
      </a></span> <span class="next"><a href="/notebook/other/node.html">
        node
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.f2eb6e3f.js" defer></script><script src="/notebook/assets/js/2.b500958f.js" defer></script><script src="/notebook/assets/js/20.69bfd485.js" defer></script>
  </body>
</html>
