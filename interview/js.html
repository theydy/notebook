<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>javascript 基础 | theydy</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/notebook/icon.png">
    <meta name="description" content="读书笔记 + 知识整理">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.254e6a27.css" as="style"><link rel="preload" href="/notebook/assets/js/app.6ef8fb99.js" as="script"><link rel="preload" href="/notebook/assets/js/2.b500958f.js" as="script"><link rel="preload" href="/notebook/assets/js/16.9b778b21.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.c3ab5cb6.js"><link rel="prefetch" href="/notebook/assets/js/11.0d5f66db.js"><link rel="prefetch" href="/notebook/assets/js/12.96ace62a.js"><link rel="prefetch" href="/notebook/assets/js/13.564cae12.js"><link rel="prefetch" href="/notebook/assets/js/14.3eaa783e.js"><link rel="prefetch" href="/notebook/assets/js/15.f1f3cc2e.js"><link rel="prefetch" href="/notebook/assets/js/17.ae11984e.js"><link rel="prefetch" href="/notebook/assets/js/18.4f83f6eb.js"><link rel="prefetch" href="/notebook/assets/js/19.aaafbb43.js"><link rel="prefetch" href="/notebook/assets/js/20.de065017.js"><link rel="prefetch" href="/notebook/assets/js/21.4fae332a.js"><link rel="prefetch" href="/notebook/assets/js/22.76159f4a.js"><link rel="prefetch" href="/notebook/assets/js/23.18d00419.js"><link rel="prefetch" href="/notebook/assets/js/24.8676fad5.js"><link rel="prefetch" href="/notebook/assets/js/25.cdd52113.js"><link rel="prefetch" href="/notebook/assets/js/26.a4e1407a.js"><link rel="prefetch" href="/notebook/assets/js/27.5ea7889c.js"><link rel="prefetch" href="/notebook/assets/js/28.4f452941.js"><link rel="prefetch" href="/notebook/assets/js/29.4445e879.js"><link rel="prefetch" href="/notebook/assets/js/3.6e482d8e.js"><link rel="prefetch" href="/notebook/assets/js/30.5dbfe8c9.js"><link rel="prefetch" href="/notebook/assets/js/31.966a99c6.js"><link rel="prefetch" href="/notebook/assets/js/32.65399fb3.js"><link rel="prefetch" href="/notebook/assets/js/33.517cd9f7.js"><link rel="prefetch" href="/notebook/assets/js/34.7650cb4f.js"><link rel="prefetch" href="/notebook/assets/js/35.8cb6535a.js"><link rel="prefetch" href="/notebook/assets/js/36.e4cea6a9.js"><link rel="prefetch" href="/notebook/assets/js/37.65ab33d6.js"><link rel="prefetch" href="/notebook/assets/js/38.f8d83db7.js"><link rel="prefetch" href="/notebook/assets/js/4.779e3c9b.js"><link rel="prefetch" href="/notebook/assets/js/5.5b45f7ce.js"><link rel="prefetch" href="/notebook/assets/js/6.4bc4ed52.js"><link rel="prefetch" href="/notebook/assets/js/7.22950914.js"><link rel="prefetch" href="/notebook/assets/js/8.edafac0c.js"><link rel="prefetch" href="/notebook/assets/js/9.64de7391.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.254e6a27.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><!----> <span class="site-name">theydy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook/interview/js.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端面试
</a></div><div class="nav-item"><a href="/notebook/vue/analysis.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/notebook/react/setup.html" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/notebook/webpack/4.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/notebook/other/tools.html" class="nav-link">
  杂七杂八
</a></div><div class="nav-item"><a href="/notebook/engineering/package-json.html" class="nav-link">
  工程化
</a></div> <a href="https://github.com/theydy/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notebook/interview/js.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端面试
</a></div><div class="nav-item"><a href="/notebook/vue/analysis.html" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/notebook/react/setup.html" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/notebook/webpack/4.html" class="nav-link">
  Webpack
</a></div><div class="nav-item"><a href="/notebook/other/tools.html" class="nav-link">
  杂七杂八
</a></div><div class="nav-item"><a href="/notebook/engineering/package-json.html" class="nav-link">
  工程化
</a></div> <a href="https://github.com/theydy/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端面试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/interview/js.html" aria-current="page" class="active sidebar-link">javascript 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#数据类型检测的方式" class="sidebar-link">数据类型检测的方式</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#_0-1-0-2-0-3" class="sidebar-link">0.1 + 0.2 ! == 0.3 ？</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#原型-原型链" class="sidebar-link">原型 / 原型链</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#继承" class="sidebar-link">继承</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#作用域链" class="sidebar-link">作用域链</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#this-指向" class="sidebar-link">this 指向</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#变量提升" class="sidebar-link">变量提升</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#var、let、const-的区别" class="sidebar-link">var、let、const 的区别</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#map-和-object-的区别" class="sidebar-link">Map 和 Object 的区别</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#map-和-weakmap-的区别" class="sidebar-link">Map 和 WeakMap 的区别</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#event-loop" class="sidebar-link">event loop</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#es6-模块与-commonjs-模块有什么异同" class="sidebar-link">ES6 模块与 CommonJS 模块有什么异同？</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#promise" class="sidebar-link">promise</a></li><li class="sidebar-sub-header"><a href="/notebook/interview/js.html#generator" class="sidebar-link">generator</a></li></ul></li><li><a href="/notebook/interview/css.html" class="sidebar-link">css</a></li><li><a href="/notebook/interview/code.html" class="sidebar-link">各种手写题</a></li><li><a href="/notebook/interview/browser.html" class="sidebar-link">浏览器相关</a></li><li><a href="/notebook/interview/http.html" class="sidebar-link">HTTP 相关</a></li><li><a href="/notebook/interview/vue.html" class="sidebar-link">vue 面试题</a></li><li><a href="/notebook/interview/react.html" class="sidebar-link">react 面试题</a></li><li><a href="/notebook/interview/safety.html" class="sidebar-link">前端安全</a></li><li><a href="/notebook/interview/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/notebook/interview/optimization.html" class="sidebar-link">性能优化</a></li><li><a href="/notebook/interview/algorithm.html" class="sidebar-link">算法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-基础"><a href="#javascript-基础" class="header-anchor">#</a> javascript 基础</h1> <h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <p>JavaScript 共有八种数据类型，分别是 Undefined、Null、Boolean、Number、String、Object、Symbol、BigInt。</p> <p>这些数据可以分为原始数据类型和引用数据类型：</p> <ul><li>原始数据类型（存储在栈中）：Undefined、Null、Boolean、Number、String</li> <li>引用数据类型（存储在堆中）：Object</li></ul> <h2 id="数据类型检测的方式"><a href="#数据类型检测的方式" class="header-anchor">#</a> 数据类型检测的方式</h2> <h3 id="typeof"><a href="#typeof" class="header-anchor">#</a> typeof</h3> <p>除了数组、对象、null 都会被判断为 object，其他判断都正确</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// number</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// boolean</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token string">'str'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// string</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// object    </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// function</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// object</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// object</span>
</code></pre></div><h3 id="instanceof"><a href="#instanceof" class="header-anchor">#</a> instanceof</h3> <p>instanceof 其内部运行机制是判断在其原型链中能否找到该类型的原型，只能正确判断引用数据类型，而不能判断基本数据类型。</p> <h3 id="object-prototype-tostring-call"><a href="#object-prototype-tostring-call" class="header-anchor">#</a> Object.prototype.toString.call()</h3> <p>可以准确判断数据类型。之所以要使用 Object 原型上的 toString 方法做判断，是因为 Array、Function 等类型作为 Object 的实例，都重写了 toString 方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> toString <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// [object Number]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// [object Boolean]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// [object String]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// [object Array]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// [object Function]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// [object Object]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// [object Undefined]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// [object Null]</span>
</code></pre></div><h2 id="_0-1-0-2-0-3"><a href="#_0-1-0-2-0-3" class="header-anchor">#</a> 0.1 + 0.2 ! == 0.3 ？</h2> <p>因为实际上数字是以二进制的形式存储的，而浮点数十进制转二进制，整数部分是不停的除 2 取余数逆序，小数部分是不停的乘 2 取整数正序。</p> <p>0.1 二进制表示是 0.0001100110011001100...（1100循环），0.2 二进制表示是：0.00110011001100...（1100循环）。都不能准确表示，在允许的存储范围外会舍弃，遵从“0舍1入”的原则，自然存在精度问题。</p> <p>如果两个浮点数相加正好相等，那是运气，说明误差范围正好都在舍弃的部分。</p> <h2 id="原型-原型链"><a href="#原型-原型链" class="header-anchor">#</a> 原型 / 原型链</h2> <h3 id="prototype"><a href="#prototype" class="header-anchor">#</a> prototype</h3> <p>每个函数都有一个 <code>prototype</code> 属性。</p> <p><strong>这个 <code>prototype</code> 属性指向的是使用该函数做为构造函数生成对象的原型。</strong></p> <p>🌰：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

a<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">A</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
</code></pre></div><p>这里引出另一条原型链的指向规律：<strong>对于每个普通对象来说，都有一个 <code>__proto__</code> 指向它的原型。</strong></p> <p>对于函数来说，既有 <code>prototype</code> 又有 <code>__proto__</code> 。</p> <h3 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor</h3> <p><strong>每个原型都有一个 constructor 属性指向关联的构造函数。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token constant">A</span> <span class="token operator">===</span> <span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token comment">// true</span>
</code></pre></div><p>综上所述，如果要手动指定一个构造函数的原型链的话，应该这样指定。这就是原型链继承。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> origin <span class="token operator">=</span> <span class="token punctuation">{</span> origin<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

origin<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">;</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> origin<span class="token punctuation">;</span>
</code></pre></div><h3 id="原型链"><a href="#原型链" class="header-anchor">#</a> 原型链</h3> <p>当读取对象的属性时，如果找不到，就会查找与对象关联的原型中的属性，如果还查不到，就去找原型的原型，一直找到最顶层为止。</p> <p>最顶层即：<code>Object.prototype.__proto__ === null</code></p> <p>对象通过 <code>__proto__</code> 属性与原型对象连接，直到 <code>null</code> 的这条链状结构就是原型链。</p> <h3 id="proto"><a href="#proto" class="header-anchor">#</a> <strong>proto</strong></h3> <p><strong>proto</strong> 并不存在于原型上，实际上，它是来自于 Object.prototype ，与其说是一个属性，不如说是一个 getter/setter，当使用 obj.<strong>proto</strong> 时，可以理解成返回了 <code>Object.getPrototypeOf(obj)</code>。</p> <h2 id="继承"><a href="#继承" class="header-anchor">#</a> 继承</h2> <h3 id="es5-的继承"><a href="#es5-的继承" class="header-anchor">#</a> es5 的继承</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 原型继承</span>
<span class="token comment">// 优：可以继承父类的属性和方法</span>
<span class="token comment">// 缺：父类属性如果是引用类型，会被所有子类共用；创建子类时，无法向父类传参</span>
<span class="token keyword">function</span> <span class="token function">prototypeExtend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 构造函数继承</span>
<span class="token comment">// 优：避免了原型链继承的缺点</span>
<span class="token comment">// 缺：只继承父类在构造函数中的属性方法，无法继承原型上的属性方法</span>
<span class="token keyword">function</span> <span class="token function">constructorExtend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. 组合继承</span>
<span class="token comment">//缺：执行了两次父类的构造函数，子类原型上会有多余的父类属性</span>
<span class="token keyword">function</span> <span class="token function">combinationExtend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 4. 寄生组合继承</span>
<span class="token keyword">function</span> <span class="token function">extend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="es5-与-es6-class-继承的不同"><a href="#es5-与-es6-class-继承的不同" class="header-anchor">#</a> es5 与 es6 class 继承的不同</h3> <h2 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h2> <p>当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)。</p> <p>对于每个执行上下文，都有三个重要属性：</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <p>当查找变量时，会先从当前上下文的变量对象中查找，如果没有找到，就会从词法层面的父级执行上下文的变量对象中查找，直到全局上下文的变量对象。这样由多个执行上下文的变量对象构成的链表就是作用域链。</p> <h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <p>有权限访问其他其他函数作用域中变量的函数就叫做闭包。</p> <h3 id="闭包的作用"><a href="#闭包的作用" class="header-anchor">#</a> 闭包的作用</h3> <ul><li>延长变量的生命周期</li> <li>实现 private 属性</li></ul> <h2 id="this-指向"><a href="#this-指向" class="header-anchor">#</a> this 指向</h2> <ul><li>方法中调用：指向调用者</li> <li>构造函数中调用：指向新生成的对象</li> <li>箭头函数中调用：与最近一层非箭头函数所在环境的 this 保持一致</li> <li>call apply bind 调用：指向指定的 this</li></ul> <p>箭头函数中的 this 不能通过 call apply bind 修改。</p> <p>bind this 返回的函数不能再通过 call apply bind 修改 this 指向。</p> <h2 id="变量提升"><a href="#变量提升" class="header-anchor">#</a> 变量提升</h2> <p>进入执行上下文时，首先会处理函数声明，其次会处理变量声明，函数声明比变量声明优先度高。</p> <h2 id="var、let、const-的区别"><a href="#var、let、const-的区别" class="header-anchor">#</a> var、let、const 的区别</h2> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">var</th> <th style="text-align:center;">let</th> <th style="text-align:center;">const</th></tr></thead> <tbody><tr><td style="text-align:center;">块级作用域</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">⭕️</td> <td style="text-align:center;">⭕️</td></tr> <tr><td style="text-align:center;">重复声明</td> <td style="text-align:center;">⭕️</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td style="text-align:center;">暂时性死区</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">⭕️</td> <td style="text-align:center;">⭕️</td></tr> <tr><td style="text-align:center;">必须设置初始值</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">⭕️</td></tr> <tr><td style="text-align:center;">重新赋值</td> <td style="text-align:center;">⭕️</td> <td style="text-align:center;">⭕️</td> <td style="text-align:center;">❌</td></tr></tbody></table> <h2 id="map-和-object-的区别"><a href="#map-和-object-的区别" class="header-anchor">#</a> Map 和 Object 的区别</h2> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;">Map</th> <th style="text-align:center;">Object</th></tr></thead> <tbody><tr><td style="text-align:center;">键的类型</td> <td style="text-align:center;">Map 的键可以是任意值，包括函数、对象或任意基本类型</td> <td style="text-align:center;">Object 的键必须是 String 或是 Symbol</td></tr> <tr><td style="text-align:center;">键的顺序</td> <td style="text-align:center;">Map 中的 key 是有序的。遵从插入的顺序</td> <td style="text-align:center;">Object 的键是无序的</td></tr> <tr><td style="text-align:center;">size</td> <td style="text-align:center;">Map 的键值对个数可以轻易地通过 size 属性获取</td> <td style="text-align:center;">Object 的键值对个数只能手动计算</td></tr></tbody></table> <h2 id="map-和-weakmap-的区别"><a href="#map-和-weakmap-的区别" class="header-anchor">#</a> Map 和 WeakMap 的区别</h2> <p>WeakMap 的键只能是对象，并且作为对象的键是弱引用，即垃圾回收机制不会把键的引用计算在内。</p> <p>如果这个对象的其他引用都被清除，就能被垃圾回收，WeakMap 中的键值对自动会删除。</p> <h2 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> event loop</h2> <p>函数执行时，会生成这个函数对应的执行上下文，执行上下文包含这个函数的作用域、this、定义的变量。</p> <p>然后这个执行上下文会被放入执行栈中，如果碰到异步任务，会将异步任务挂起继续执行执行栈中其他的任务，等到异步任务完成，结果会被放入任务队列中，等到执行栈中的任务全部完成，就会把任务队列排在第一的任务放入执行栈中继续执行，这就是 event loop。</p> <p>任务队列中的任务又分为宏任务（global、setTimeout、setInterval）、微任务（Promise.then、MutationObserver）。</p> <p>在一次 event loop 中总是先执行一个宏任务，然后执行全部微任务，视图重新渲染。</p> <h2 id="es6-模块与-commonjs-模块有什么异同"><a href="#es6-模块与-commonjs-模块有什么异同" class="header-anchor">#</a> ES6 模块与 CommonJS 模块有什么异同？</h2> <p>ES Module 和 CommonJS 模块的区别：</p> <ul><li>CommonJS 是对模块的浅拷⻉，ES Module 是对模块的引⽤，即 ES Module 不能改变其值，也就是指针指向不能变，类似 const；</li> <li>CommonJS 是动态语法可以写在判断里，ES Module 静态语法只能写在顶层</li> <li>CommonJS 是加载时运行，ES Module 是编译时确定的，可以静态分析</li></ul> <p>ES6 Module 和 CommonJS 模块的共同点：</p> <ul><li>CommonJS 和 ES6 Module 都可以对引⼊的对象进⾏赋值，即对对象内部属性的值进⾏改变。</li></ul> <p>node 中默认使用的是 CommonJS 规范，但是 13 版本后，可以在 package.json 文件中添加 <code>&quot;type&quot;: &quot;module&quot;</code> 使用 ES Module。</p> <p>tree-shaking 是 webpack 的一项功能，tree-shaking 只能在 ES Module 中使用，如果先通过 babel 转为 CommonJS 就用不了。</p> <blockquote><p>通过静态分析 es6 的语法，可以删除没有被使用的模块。要使用这项技术，只能使用 webpack 的模块处理，加上 babel 的 es6 转换能力（需要关闭模块转换）。</p></blockquote> <h2 id="promise"><a href="#promise" class="header-anchor">#</a> promise</h2> <p>promise 是一个等待被异步执行的对象，它有三种状态（pending, resolved, rejected），默认状态是 pending，当它执行完成后，其状态会变成 resolved 或者 rejected，状态一旦改变就不能再变。支持使用 then 方法链式调用，每次执行 then 方法后返回的是一个新的 promise 对象。</p> <p>promise 主要解决了回调地域的问题</p> <h3 id="promise-常见面试题"><a href="#promise-常见面试题" class="header-anchor">#</a> promise 常见面试题</h3> <h4 id="promise-同步执行"><a href="#promise-同步执行" class="header-anchor">#</a> promise 同步执行</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实现 mergePromise</span>
<span class="token comment">// 最后输出: 1, 2, 3 'done' [1, 2, 3]</span>
<span class="token keyword">const</span> <span class="token function-variable function">timeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ajax1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ajax2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">ajax3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mergePromise</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> target<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>target <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//test</span>
<span class="token function">mergePromise</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ajax1<span class="token punctuation">,</span> ajax2<span class="token punctuation">,</span> ajax3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="promise-限制并行请求个数"><a href="#promise-限制并行请求个数" class="header-anchor">#</a> promise 限制并行请求个数</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">timeout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">addTask</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> order</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">multiPromise</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> nums <span class="token operator">=</span> <span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">run</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span> request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      result<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
      done<span class="token operator">++</span><span class="token punctuation">;</span>

      done <span class="token operator">===</span> args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      list<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> list<span class="token punctuation">.</span>length<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token function">run</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">addTask</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="promise-异步相加"><a href="#promise-异步相加" class="header-anchor">#</a> promise 异步相加</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">addRemote</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">addRemote</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> promiseList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promiseList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">addRemote</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseList<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">...</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// test</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="generator"><a href="#generator" class="header-anchor">#</a> generator</h2> <p><code>generator</code> 函数调用时不会立即执行，而是会生成一个迭代器对象。</p> <p>每当调用迭代器对象的 <code>next</code> 方法时，函数运行到下一个 <code>yield</code> 表达式。</p> <p>返回表达式结果并暂停自身，返回值是一个 done、value 的对象。当抵达函数的末尾时，返回结果中 done 的值为 true，value 的值为 undefined。</p> <h3 id="简单使用"><a href="#简单使用" class="header-anchor">#</a> 简单使用</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> iter <span class="token operator">=</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{value:1，done:false}</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{value:2，done:false}</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{value:3，done:false}</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{value:undefined，done:true}</span>
</code></pre></div><h3 id="es-5-中的实现"><a href="#es-5-中的实现" class="header-anchor">#</a> es 5 中的实现</h3> <p><strong>编译器会生成一个内部类来保存上下文信息，然后将 yield return 表达式转换成 switch case，通过状态机模式实现 yield 关键字的特性。</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">gen$</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>prev <span class="token operator">=</span> context<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
        context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">'result1'</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">'result2'</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
        context<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">'result3'</span><span class="token punctuation">;</span>

      <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
        context<span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> context <span class="token operator">=</span> <span class="token punctuation">{</span>
    prev<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    next<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    done<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">gen$</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">,</span>
        done<span class="token operator">:</span> context<span class="token punctuation">.</span>done<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// test </span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: result1, done: false }</span>
a<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: result2, done: false }</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">6/30/2022, 1:15:23 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/notebook/interview/css.html">
        css
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.6ef8fb99.js" defer></script><script src="/notebook/assets/js/2.b500958f.js" defer></script><script src="/notebook/assets/js/16.9b778b21.js" defer></script>
  </body>
</html>
